# `かんしくん` とは

`かんしくん` は、音声合成ソフトが作成した `*.wav` と `*.txt` を取り込むための連携ツールです。

このツールがなくても問題なく PSDToolKit を使うことができますが、このツールを使うことで音声合成ソフトからの出力を自動的に拡張編集へ取り込むことができるようになるため、より効率的に作業を進めることができます。

# 使い方

1. PSDToolKit の [環境設定ダイアログ](setting.md#環境設定ダイアログ) で、`1フレーム目に音声とテキストがある *.exo をドロップした時` にチェックを入れます。  
※このチェックを入れないと [`口パク準備`](prep.md#口パク準備) や [`字幕準備`](prep.md#字幕準備) などのオブジェクトが自動生成されません。
2. [かんしくん設定ファイル作成ツール](https://oov.github.io/forcepser/) にアクセスして、設定を作成して、`setting.txt` をダウンロードします。
3. ダウンロードした `setting.txt` を、「かんしくん」のフォルダーにコピーします。
4. `forcepser.exe` を起動すると黒いウィンドウが現れ、フォルダーの監視が始まります。

監視中の対象フォルダーに名前のルールを満たす `*.wav` と `*.txt` が作成されると、拡張編集の現在のカーソル位置へファイルがドロップされます。

# 困ったときは

## 「AviUtl のプロジェクトファイルがまだ保存されていないため処理を続行できません」というエラーが出る

これは AviUtl のプロジェクトファイルがまだ保存されていないため処理を続行できない、ということを伝えているエラーです。

AviUtl のプロジェクトファイルを保存してからもう一度試してみてください。

## うまく反応しない・文字化けする

[かんしくん設定ファイル作成ツール](https://oov.github.io/forcepser/)では音声合成ソフト側で行うべき設定の案内もしているので、ツールの案内に従ってみてください。

### CoeFont Studio が動かない

かんしくんを使うには同じ名前の `*.wav` と `*.txt` が作成されることが必要ですが、現在の CoeFont Studio ではそのような動作になっていないため、そのままだとかんしくんを使うことはできません。

[セリフ単体のダウンロード時にテキストを保存する Chrome 拡張機能](https://github.com/oov/coefont_autotxtdl)を用意しているので、これがうまく動けば使えるはずです。

## かんしくん設定ファイル作成ツールに使いたいキャラクターがいない

音声合成ソフトはリストにあるけどキャラクターがいない、という状況の場合は以下の手順を参考にしてみてください。

1. まずは目的のキャラクターがいない状態のまま[かんしくん設定ファイル作成ツール](https://oov.github.io/forcepser/)で設定ファイルを作成し、通常通りにかんしくんを起動します。
2. そのまま未登録のキャラクターで音声を保存して、`一致するルールが見つかりませんでした` というエラーメッセージが出ることを確認します。
3. かんしくんと同じ場所にある `tmp` フォルダーの中を見ると、そのキャラクターの名前を含む `*.wav` や `*.txt` があるはずなので、そのファイル名からキャラクターの名前だけをコピーします。
4. [かんしくん設定ファイル作成ツール](https://oov.github.io/forcepser/)でキャラクターリストの一番下には `新規ボイス` や `新規トラック` など自由入力タイプの項目があるので、それでコピーしておいたキャラクター名を貼り付けてください。
5. 改めて設定ファイルを作成して、かんしくんを使ってみてください。

## かんしくん設定ファイル作成ツールに使いたい音声合成ソフトがない

かんしくんは仕組み上、同じ名前の `*.wav` と `*.txt` を同時に出力するソフトであれば大抵は連携できます。

ただしそのためには[仕様](https://github.com/oov/forcepser/wiki/%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6(0.1beta15%E4%BB%A5%E9%99%8D))に従って設定を書く必要があり、理解せずに書くのは難しいです。

もし似たソフトが既にある場合は、流用して上手く動かないか試してみてください。  
例えば GUI が VOICEVOX 系のソフトであれば、VOICEVOX の設定をある程度流用できるかもしれません。

## 音声ファイルの保存場所を変えたい

デフォルトでは AviUtl のプロジェクトファイルがある場所に音声ファイルが配置されていきますが、`setting.txt` の `destdir` を書き換えればこれを変更することもできます。  
`[[rule]]` セクション内で変更すれば、キャラクターごとに別のフォルダーに配置するようなこともできます。

ただし、これを変更することには運用上のデメリットがあるため、変更することはおすすめしません。  
`setting.txt` の注意書きを読み、十分に理解した上で自己責任で変更してください。
